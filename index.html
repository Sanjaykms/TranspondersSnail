<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="TranspondersSnail.jpg" sizes="any" rel="icon" type="image/jpg">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Rum+Raisin&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#161616">
    <title>Transponders Snail</title>
    <style>
      *{
        padding: 0%;
        margin: 0%;
        box-sizing: border-box;
        font-family: 'Rum Raisin', sans-serif;
        outline: none;
        transition: 0.5s;
        scroll-behavior: smooth;
        letter-spacing: 1px;
      }
      body{
        background: radial-gradient(ellipse at center, #94B4E7, #3F02DC);
        background-repeat: no-repeat;
        background-attachment: fixed;
        height: 100vh;
      }
      .mainarea{
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        margin-top: 20px;
        padding: 30px;
      }
      .mainarea h1{
        font-size: 2em;
        padding: 14px 18px;
        display: flex;
        align-items: center;
        letter-spacing: 2px;
        color: rgb(131, 130, 130);
        text-shadow: 0px 1.2px rgb(5, 5, 5);
        font-weight: 900;
        background-color: white;
        border-radius: 32px 32px 60px 60px;
        overflow: hidden;
        box-shadow: 10px 10px 20px rgb(18, 0, 121);
      }
      .mainarea h1 img{
        width: 50px;
        height: 50px;
        margin: 0 5px;
      }
      .mainarea .loginarea{
        max-width: 800px;
        min-width: none;
      }
      .mainarea .loginarea .signin{
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }
      .mainarea .loginarea .signin label,.messagingarea label{
        display: flex;
        justify-content: center;
        flex-direction: column;
        padding-top: 5px;
        margin-top: 25px;
        position: relative;
        cursor: pointer;
        width: 330px;
        overflow: hidden;
      }
      .messagingarea{
        position: relative; 
        height:80vh;
        width: 600px;
      }
      .messagingarea label{
        margin-top: 0;
      }
      .messagingarea .typingarea{
        position: absolute;
        display: grid;
        grid-template-columns: auto 40px 60px;
        background-color: white;
        padding: 5px;
        bottom: 0;
        left: 0;
        width: 100%;
        border-radius: 10px;
      }
      .messagingarea .typingarea button{
        background-color: rgb(177, 177, 177);
        border: none;
      }
      .messagingarea .typingarea button:nth-last-child(1){
        padding: 8px;
        color: white;
        font-weight: 900;
        border-radius: 0 6px 6px 0;
      }
      .messagingarea .typingarea button:nth-last-child(2){
        margin: 0 5px;
      }
      .messagingarea .typingarea #mess{
        padding-left: 5px;
        border-radius: 6px 0 0 6px;
        border: 1.5px solid black;
      }
      .messagingarea .messages{
        height: 80%;
        width: 100%;
        margin-top: 10px;
        overflow:auto;
      }
      .messagingarea label{
        width: 100%;
      }
      .messagingarea .messages::-webkit-scrollbar{
        display: none;
      }
      .messagingarea .messages .messslide{
        position: absolute;
        right: 15px;
        bottom: 60px;
        padding: 3px;
        background-color: white;
        border-radius: 50%;
        cursor: pointer;
        user-select: none;
        opacity: 0.8;
        transform: rotate(90deg);
        font-size: 25px;
        transition: none;
      }
      .messagingarea .messages .messslide a{
        text-decoration: none;
      }
      .mainarea .loginarea .signin label input,.messagingarea label input{
        border: none;
        background-color: transparent;
        transform: translate(0,100%);
        color: rgb(0, 56, 121);
        border-bottom: 2px solid rgb(212, 212, 212);
        font-size: 1em;
        outline: none;
      }
      .mainarea .loginarea .signin label .bord,.messagingarea label .bord{
        border-bottom: 2px solid rgb(0, 0, 158);
        transform: translate(-100%,0);
        transition: 0.5s;
      }
      .mainarea .loginarea .signin label .words,.messagingarea label .words{
        transition: 0.5s;
        opacity: 1;
        transform: translate(0,-2px);
        color: white;
      }
      .mainarea .loginarea .signin label input:focus+.words+.bord,.mainarea .loginarea .signin label input:valid+.words+.bord,.messagingarea label input:focus+.words+.bord,.messagingarea label input:valid+.words+.bord{
        transform: translate(0,0);
      }
      .mainarea .loginarea .signin label input:focus+.words,.mainarea .loginarea .signin label input:valid+.words,.messagingarea label input:focus+.words,.messagingarea label input:valid+.words{
        transform: translate(0,-100%);
        opacity: 0.5;
      }
      .mainarea .loginarea .signin button{
        margin: 30px 0;
        padding: 5px 20px;
        border: none;
        color: rgb(16, 16, 122);
        background-color: rgb(100, 100, 255);
        border-radius: 32px 32px 60px 60px;
        cursor: pointer;
      }
      .mainarea .loginarea .signin button:active{
        background-color: rgba(100, 100, 255, 0.555);
      }
      .mainarea .loginarea .signin p{
        text-align: left;
        margin: 20px 0;
        font-size: 15px;
        color: rgb(0, 0, 90);
      }
      .mainarea .loginarea .signin h3 input{
        padding: 5px 20px;
        border: none;
        color: rgb(25, 122, 16);
        background-color: rgb(40, 224, 49);
        border-radius: 32px 32px 60px 60px;
        cursor: pointer;
      }
      .mainarea .loginarea .signin h3 input:active{
        background-color: rgba(40, 224, 49, 0.521);
      }
      .login{
        transform: translate(0,-20%);
      }
      .part{
        margin: 10px 0;
        background-color: rgb(43, 255, 0);
        border-radius: 0 20px 20px 0;
        padding: 10px;
        color: white;
        overflow: auto;
      }
      .part h6{
        color: rgb(22, 119, 3);
      }
      .part h6:nth-last-child(1){
        text-align: right;
      }
      @media (max-width:720px) {
        .mainarea{
          padding: 15px 10px 10px 10px;
        }
        .mainarea h1{
          padding: 9px 15px;
          font-size: 20px;
        }
        .mainarea h1 img{
          width: 35px;
          height: 35px;
        }
        .mainarea .loginarea .signin label,.messagingarea label{
          width: auto;
        }
        .mainarea .loginarea .signin h3{
          font-size: 15px;
        }
        .mainarea .loginarea .signin p{
          font-size: 13px;
        }
        .messagingarea{
          width: 100%;
        }
      }
      /*loading area*/
      .load{
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100vh;
            background-color: black;
            align-items: center;
            justify-content: center;
            color: white;
        }
        .load .content{
            position: relative;
            width:550px;
            height: 300px;
            background-color: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .load .content .line{
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background-color: rgb(43, 253, 43);
            transform: scaleX(0);
            animation: animate 5s infinite cubic-bezier(0.85, 0.02, 0.17, 1.01) 1s;
        }
        @keyframes animate{
            0%{
                transform: scaleX(0);
            }
            20%{
                transform: scaleX(0);
            }
            50%{
                transform: scaleX(1);
            }
            70%{
                transform: scaleX(1);
            }
            100%{
                transform: scaleX(0);
            }
        }
        .load .content .pen{
            position: absolute;
            width: 50%;
            height: 23px;
            top: 19px;
            left: 37%;
            transform: rotate(120deg);
            background-image: linear-gradient(to right,transparent 15%,rgb(43, 253, 43) 15%,rgb(43, 253, 43) 85%);
            border-radius: 5px;
            animation: anime 5s infinite cubic-bezier(0.85, 0.02, 0.17, 1.01) 1s;
        }
        @keyframes anime{
           0%{
               top: 19px;
               left: 37%;
               transform: rotate(120deg);
           }
           10%{
               top:0px;
           }
           20%{
               left: 37%;
               transform: rotate(-60deg);
           }
           23%{
               top:19px;
           }
           50%{
               top:19px;
               left: 87%;
               transform: rotate(-60deg);
           }
           60%{
               top:35px;
               left: 95%;
           }
           70%{
               top:20px;
               left: 87%;
               transform: rotate(120deg);
           }
           100%{
               left: 37%;
               transform: rotate(120deg);
           }
        }
        .load .content .pen::after{
            content: "";
            position: absolute;
            right: 0;
            top: 0;
            width: 20px;
            height: 100%;
            border-radius: 0 5px 5px 0;
            background-color: rgb(41, 41, 41);
            z-index: -1;
        }
        .load .content .pen::before{
            content: "";
            position: absolute;
            left:-20px;
            top: 0;
            border:solid;
            border-width: 11.5px 50px 11.5px 11.5px;
            border-color: transparent rgb(41, 41, 41) transparent transparent;
            z-index: -1;
        }
        .load .content .pen .front{
            position: absolute;
            left:-34px;
            top: 0;
            border:solid;
            width: 2px;
            height: 2px;
            border-radius: 50px;
            border-width: 11.5px 50px 11.5px 11.5px;
            border-color: transparent rgb(43, 253, 43) transparent transparent; 
            transform: scale(0.3);
            z-index: 1;
        } 
        @media (max-width:550px) {
            .load .content{
                width: 50%;
                height: 25%;
            }
            .load .content .pen{
                background-image: linear-gradient(to right,transparent 40%,rgb(43, 253, 43) 40%,rgb(43, 253, 43) 40%);
            }
            .load div:nth-last-child(1){
                font-size: 15px !important;
            }
        }
        @media (max-width:320px) {
            .load .content .pen{
                background-image: linear-gradient(to right,transparent 50%,rgb(43, 253, 43) 50%,rgb(43, 253, 43) 50%);
            }
        }
    </style>
</head>
<body onload="loaded()">
  <div class="load">
    <div class="content">
        <div class="line"></div>
        <div class="pen">
            <span class="front"></span>
        </div>
    </div>
    <div style="font-size:1.5rem;text-transform: uppercase;letter-spacing: 10px;">Loading...</div>
</div>
    <div class="mainarea" style="display: none;">
      <h1 class="snail"><img src="TranspondersSnail.jpg">TRANSPONDERS SNAIL</h1>
      <div class="loginarea">
          <form class="signin" onsubmit="submitfire(event)">
              <label>
                <input type="text" id="signName" required>
                <span class="words">Email-id</span>
                <span class="bord"></span>
              </label>
              <label>
                <input type="password" id="signPass" required>
                <span class="words">Password</span>
                <span class="bord"></span>
              </label>
              <button type="submit">Sign in</button>
              <h3><span style="font-style:italic;color:red">Don't have an Account :</span>  Get sign in authority at <input type="button" value="Request" onclick="request()"></h3>
              <p>Note : Above Request option needs Email id. So make sure to enter a valid email in above Email area [ no need for any other details only email ] .</p>
            </form>
      </div>  
      <div class="messagingarea" style="display: none;">
        <label style="pointer-events: none;">
          <input type="text" id="signNick" required>
          <span class="words">Transponder Name</span>
          <span class="bord"></span>
        </label>
        <div class="messages">
          <div class="part">
            <p>Enter some message here.</p>
          </div>
          <div class="messings">
          </div>
          <span id="track"></span>
          <div class="messslide"><a href="#track">➠</a></div>
        </div>
        <form class="typingarea" onsubmit="return false;">
            <input type="text" placeholder="Type a message" id="mess">
            <button type="submit" onclick="insert()">🐌</button>
          <button type="button" onclick="logout()">Log out</button>
        </form>
      </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-analytics.js"></script>

      <!-- Add Firebase products that you want to use -->
      <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-firestore.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-database.js"></script>
        <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyDp8K3w2zAatmcZfp1za0M0fP1-_5mVgIg",
        authDomain: "transponders-snail.firebaseapp.com",
        databaseURL: "https://transponders-snail-default-rtdb.firebaseio.com",
        projectId: "transponders-snail",
        storageBucket: "transponders-snail.appspot.com",
        messagingSenderId: "726588618357",
        appId: "1:726588618357:web:b4d31f5b5bb5b98f7c2a3c"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      var database = firebase.database();
      //declaration
      var signName,signPass,signNick,userId;
      function ready(){
        signName=document.getElementById("signName").value;
        signPass=document.getElementById("signPass").value;
      }
      function clear(){
        document.getElementById("signName").value="";
        document.getElementById("signPass").value="";
      }
      function refresh(){
        location.reload();
      }
      firebase.auth().onAuthStateChanged((user) => {
        if (user) {
          // User is signed in, see docs for a list of available properties
          // https://firebase.google.com/docs/reference/js/firebase.User
          var uid = user.uid;
          userId=uid;
          document.getElementsByClassName("loginarea")[0].style.display="none";
          document.getElementsByClassName("snail")[0].classList.add("login");
          document.getElementsByClassName("messagingarea")[0].style.display="initial";
          // ... check for auto scroll
         var inter=setInterval(() => {
      if((document.getElementsByClassName("messages")[0].scrollHeight)-(document.getElementsByClassName("messages")[0].scrollTop+document.getElementsByClassName("messages")[0].clientHeight)<80){
        document.querySelector(".messslide").style.visibility="hidden";
        document.querySelector(".messslide").style.pointerEvents="none";
      }
      else{
        document.querySelector(".messslide").style.visibility="visible";
        document.querySelector(".messslide").style.pointerEvents="auto";
      }
    }, 100);
    // inserting messages goes here
    document.getElementsByClassName("messings")[0].innerHTML="";
    firebase.database().ref().child("Chats").on('child_added',(snapshot)=>{
       if(snapshot.exists()){
         var htm="";
         if(snapshot.val().userId!=userId){
           htm+="<div class='part' style='background:#ff675c;text-align:right;border-radius:20px 0 0 20px;'>";
         }else{
           htm+="<div class='part'>";
         }
         if(snapshot.val().userId!=userId){
           htm+="<h6 style='color:#992820;'>"+snapshot.val().nick;
         }
         else{
           htm+="<h6>"+snapshot.val().nick;
         }
         htm+="</h6><p id='para"+snapshot.key+"'>";
         htm+=snapshot.val().message+"</p>";
         if(snapshot.val().userId!=userId){
           htm+="<h6 style='color:#992820;text-align:left;'>"+snapshot.val().hours+":"+snapshot.val().mins+" "+snapshot.val().date+"/"+(snapshot.val().month+1)+"/"+snapshot.val().year+"</h6>";
         }
         else{
           htm+="<h6><button style='background-color:#444;padding:2px 8px;color:white;font-weight:900;border:none;border-radius:20px;cursor:pointer;' onclick='deleted(this)' data-id='"+snapshot.key+"'>Delete</button> "+snapshot.val().hours+":"+snapshot.val().mins+" "+snapshot.val().date+"/"+(snapshot.val().month+1)+"/"+snapshot.val().year+"</h6>";
         }
         htm+="</div>";
         document.getElementsByClassName("messings")[0].innerHTML+=htm;
         document.querySelector(".messslide a").click();
       }
     });
     //
     firebase.database().ref().child("profile").child(userId).get().then((snapshot)=>{
       if(snapshot.exists()){
         document.getElementById("signNick").value=snapshot.val();
       }
     });
     firebase.database().ref().child("profile").get().then((snapshot)=>{
       if(snapshot.exists()){
         console.log(snapshot.val());
       }
     });
        } else {
          // User is signed out
          // ...
          document.getElementsByClassName("loginarea")[0].style.display="initial";
          document.getElementsByClassName("snail")[0].classList.remove("login");
          document.getElementsByClassName("messagingarea")[0].style.display="none";
          clearInterval(inter);
        }
      });
      function submitfire(e){
        e.preventDefault();
        ready();
        firebase.auth().signInWithEmailAndPassword(signName, signPass)
        .then((userCredential) => {
          // Signed in 
          var user = userCredential.user;
          clear();
          // ...
        })
        .catch((error) => {
          var errorCode = error.code;
          var errorMessage = error.message;
          alert(errorCode+"  "+errorMessage);
          // ..
        });
      }
      function logout(){
        if(confirm("Do you want to Log Out?")){
        firebase.auth().signOut().then(() => {
        // Sign-out successful.
        }).catch((error) => {
          // An error happened.
          alert(error);
        });
      }
      }
      function request(e){
        ready();
        if(signName.length>10){
          firebase.database().ref('Requests/' + firebase.database().ref("Requests").push().getKey()).set({
            e_mail:signName,
          })
          alert("Inserted");
          clear();
        }
        else{
          alert("Enter valid email");
        }
      }
      function insert(){
        var mess=document.getElementById("mess").value;
        signNick=document.getElementById("signNick").value;
        if(signNick.length>0){
        if(mess.length>0){
          var v=firebase.database().ref("Chats").push().getKey();
          firebase.database().ref('Chats/' + v).set({
          userId:userId,
          date:new Date().getDate(),
          month:new Date().getMonth(),
          year:new Date().getFullYear(),
          hours:new Date().getHours(),
          mins:new Date().getMinutes(),
          message:mess,
          nick:signNick,
        });
        document.getElementById("mess").value="";
        }
      }
      else{
        alert("Enter a Transponder Name to Continue");
      }
      return false;
      }
       // delete
       function deleted(self){
        var messId=self.getAttribute("data-id");
        firebase.database().ref("Chats/"+messId).remove();
      }
     // listener remove
     firebase.database().ref().child("Chats").on('child_removed',(snapshot)=>{
       document.getElementById("para"+snapshot.key).innerHTML="⚠ This message has been removed !";
     });
     //loading function
     function loaded(){
       document.getElementsByClassName("load")[0].style.display="none";
       document.getElementsByClassName("mainarea")[0].style.display="flex";
     }
    </script> 
</body>
</html>
